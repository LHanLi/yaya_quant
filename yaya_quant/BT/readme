# backtrader  MA 2017.6.1-2022.6.1
# MA strategy


import pandas as pd
import numpy as np
from sqlalchemy import create_engine
from bokeh.plotting import figure, output_notebook, show ,save
import matplotlib.pyplot as plt
import copy
from yaya_quant.BT import main
from yaya_quant.BT import Strategy
from yaya_quant.BT import CTA
#from yaya_quant.BT import Indicator
from yaya_quant.re import eval as quant_eval
import backtrader as bt
# Import the backtrader platform
from backtrader_plotting import Bokeh
from backtrader_plotting.schemes import Tradimo



df_heyue = pd.read_csv('THS_trading_daily_price.csv',index_col=0)
# index should be datetime(easy to plot)
df_heyue.date = pd.to_datetime(df_heyue.date)
# remove failed data
df_heyue = df_heyue.drop(index=df_heyue[df_heyue.close == 0].index)


# heyue_total is MA de quanbu heyue
secu_A = 'MA'
# I is 1,5,9  RB is 1,5,10 
main_list = ['01','05','09']
heyue_total = df_heyue[df_heyue.code.apply(lambda x: secu_A == ''.join([i for i in x[:2] if i.isalpha()]))]

# from start to end
starttime = pd._libs.tslibs.timestamps.Timestamp('2015-06-01 00:00:00')
endtime = pd._libs.tslibs.timestamps.Timestamp('2022-06-01 00:00:00')
heyue_total = heyue_total[heyue_total.date>starttime]
heyue_total = heyue_total[heyue_total.date<endtime]










